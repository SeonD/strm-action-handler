{"version":3,"sources":["../../src/handlers/json_patch.js"],"names":["ajv","Ajv","validate","patch","validatePatch","compile","PATCH_SCHEMA","apply","document","params","newDocument"],"mappings":";;;;;;;AAAA;;AACA;;AAEA;;;;AAEA,MAAMA,GAAG,GAAG,IAAIC,YAAJ,EAAZ,C,CAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMC,QAAQ,GAAG,CAAC,CAAEC,KAAF,CAAD,KAAe;AAC5B,QAAMC,aAAa,GAAGJ,GAAG,CAACK,OAAJ,CAAYC,mBAAZ,CAAtB;;AACA,MAAI,CAACF,aAAa,CAACD,KAAD,CAAlB,EAA2B;AACvB,WAAO,KAAP;AACH;;AACD,SAAO,IAAP;AACH,CAND;;AAQA,MAAMI,KAAK,GAAG,CAACC,QAAD,EAAWC,MAAX,KAAsB;AAChC,SAAO,+BAAWD,QAAX,EAAqBC,MAAM,CAAC,CAAD,CAA3B,EAAgC,IAAhC,EAAsCC,WAA7C;AACH,CAFD;;eAIe;AAAER,EAAAA,QAAF;AAAYK,EAAAA;AAAZ,C","sourcesContent":["import { applyPatch } from 'fast-json-patch';\r\nimport Ajv from 'ajv';\r\n\r\nimport PATCH_SCHEMA from '../schema/json_patch';\r\n\r\nconst ajv = new Ajv();\r\n\r\n// Here goes some documentation about the action type, params, etc.\r\n\r\n// Example action request payload\r\n// {\r\n//     \"action_key\": \"a0932bb5508e4c377672d4af1a8f9761\",\r\n//     \"revision_number\": 16,\r\n//     \"action_type\": \"json_patch\",\r\n//     \"params\": [\r\n//         [\r\n//             {\r\n//                 \"op\": \"add\", \"path\": \"/new_field\", \"value\": \"Added in level0, with name new_field\"\r\n//             }\r\n//         ]\r\n//     ]\r\n// }\r\n\r\nconst validate = ([ patch ]) => {\r\n    const validatePatch = ajv.compile(PATCH_SCHEMA);\r\n    if (!validatePatch(patch)) {\r\n        return false;\r\n    }\r\n    return true;\r\n};\r\n\r\nconst apply = (document, params) => {\r\n    return applyPatch(document, params[0], true).newDocument;\r\n};\r\n\r\nexport default { validate, apply };\r\n"],"file":"json_patch.js"}